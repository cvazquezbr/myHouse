import socket
from xml.dom import minidom
import codecs
import sys

decode_hex = codecs.getdecoder("hex_codec")

HandShake = {b'U\xaa\x00\x06\x05\x02\x00\x00\x0c\x19U\xaa': b'U\xaa\x00\x06\x06\x02\x00\x00\x01\x0fU\xaa',
             b'U\xaa\x00\x06\x05\x03\x00\x00\x16$U\xaa': b'U\xaa\x01\x16\x06\x01\x00\x00\x03\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x01\x01#U\xaa',
             b'U\xaa\x00\x08\x05\x04\x00\x00\x15\xd3\xb5\xaeU\xaa': b'U\xaa\x00\x1b\x06\x01\x00\x00\x16Ver 04.11.00|DS 05.02/U\xaa',
}

device_config = '<?xml version="1.0" encoding="UTF-8"?><SDriverIR IRToggle="0" Name="3010">-<Functions>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB001500410016004100150016001500160015001600150016001600160015004100150041001500160016004100150016001500410016001500160041001500160015004100160041001500160015001600150041001600160015001600150041001500160016001500160041001500410015001600160041001500410015001600160019060055AA" Continuous="0" Repeats="2" FunctionName="BLANCK"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00160041001500410015001600150016001500160016001600150016001500410015004200150016001500410015001600150041001600160015004100150016001600410015004100150041001600410015001600150016001500160016004100150016001500160015001600150016001500420015004100150041001700140016001A060055AA" Continuous="0" Repeats="2" FunctionName="COLOR MODE"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00150041001600410015001600150016001500160016001600150016001500410015004100160016001500410015001600150041001600160015004100150016001500420015001600150016001500160015004100160041001500410015001600160016001500410015004100150042001500160015001600150016001500410016001A060055AA" Continuous="0" Repeats="2" FunctionName="COMPONET"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00160041001500410016001500160016001500160015001600150016001500410016004100150016001500410016001600150041001500160015004100160016001500410015001600150016001600410015004100150041001600160015001600150016001500410015004200150016001500160015001600150041001600410015001A060055AA" Continuous="0" Repeats="2" FunctionName="DEFAULT"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB001500420015004100150016001500160015001600160015001600160015004100150042001500160015004100150016001500410016001600150041001500160016004100150016001500410015001600160015001600160015001600150041001500160016004100150016001500410015004200150041001500410016001500160019060055AA" Continuous="0" Repeats="2" FunctionName="ENTER"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005601AD00150041001500420015001600150016001500160015001600150016001600410015004100150016001600410015001600150041001500160016004100150016001500160015001600150042001500160015001600150016001500160015004200150041001500410016001600150041001500410015004200150041001500160015001A060055AA" Continuous="0" Repeats="2" FunctionName="ESC"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00150042001500410015001600150016001600160015001600150016001500410015004200150016001500410015001600160041001500160015004100150016001600150016004100150041001600410015004100150041001500420015001600150041001500160016001600150016001500160015001600150016001500420015001A060055AA" Continuous="0" Repeats="2" FunctionName="GAMMA"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AD00140042001400420015001600150017001400170014001700140017001500410015004200140017001400430014001700140042001400170014004200150017001400420014004200150017001400170014004200140042001500420014001700140017001400170015004200140042001400170015001600150017001400420014001B060055AA" Continuous="0" Repeats="2" FunctionName="HDMI1"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC00140042001500420014001700140017001500160015001600150017001400420014004200150017001400420014001700140042001500170014004200140017001500420014004200140042001400170015004200140042001400420015001700140017001400170014001700140043001400170014001700140017001400420015001A060055AA" Continuous="0" Repeats="2" FunctionName="HDMI2"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC001500410016004100150016001500160015001600150016001600160015004100150041001600160015004100150016001500410016001600150041001500160015004100160041001500160015001600150042001500410015001600150041001600160015001600150041001500410016001600150016001500410015001600160019060055AA" Continuous="0" Repeats="2" FunctionName="LEFT"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC00150041001500410016001600150016001500160015001600150016001500420015004100150016001500410016001600150041001500160015004200150016001500410015004100160016001500410015001600150016001500160016004100150016001500160015004200150016001500410015004100160041001500160015001A060055AA" Continuous="0" Repeats="2" FunctionName="MEMORY"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00150041001600410015001600150016001500160016001500160016001500410015004100160016001500410015001600150042001500160015004100150016001500160016004100150016001500410015004200150016001500160015004100160041001500160015004100150016001600160015004100150041001500160016001A060055AA" Continuous="0" Repeats="2" FunctionName="MENU"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00160041001500410015001600150016001600160015001600150016001500410016004100150016001500410015001600160041001500160015004100150016001600160015004100150041001600160015004100150016001500160016004100150041001500160015001600160041001500160015004100150042001500160015001A060055AA" Continuous="0" Repeats="2" FunctionName="PATTERN"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC00150042001400420014001700150016001500170014001700140017001400420015004200140017001400420014001700150042001400170014004200150016001500420014001700140042001500420014004200140017001500160015004200140017001400420015001600150017001400170014004200140042001500170014001B060055AA" Continuous="0" Repeats="2" FunctionName="PC"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000300006D00000022005601A80016003F0016003F00160014001600140016001400160014001600140016003F0016003F001600140016003F001600140016003F001600140016003F00160014001600140016001400160014001600140016003F00160014001600140016003F0016003F0016003F0016003F0016003F001600140016003F0016003F0016001400160010060055AA" Continuous="0" Repeats="3" FunctionName="POWER TOGGLE"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006C00000022005801AA0017003E0017003F00160015001600150016001500160015001600150016003F0016003F001600150016003F001600150016003F001600150017003E00170014001700140017001400170015001600150016003F00160015001600150016003F0016003F0016003F0016003F0016003F001600150017003E0017003E0017001500160013060055AA" Continuous="0" Repeats="2" FunctionName="POWER.ON"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006C00000022005601AC001500410014004100140017001400170014001700140017001400170014004100140041001400170014004100140017001400410014001700150040001500160015004100140017001400170014001700140041001400170014001700140041001400170014004100140041001400410015001600150040001500400015001700140016060055AA" Continuous="0" Repeats="2" FunctionName="POWER.OFF"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00150041001600410015001600150016001500160016001600150016001500410015004100160016001500410015001600150042001500160015004100150016001600150016004100150016001500410016001500160016001500160015004100150042001500160015004100150016001500420015004100150041001600160015001A060055AA" Continuous="0" Repeats="2" FunctionName="PULSE ASPECT"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC00150041001500410016001600150016001500160015001600150016001600410015004100150016001600410015001600150041001500160016004100150016001500410015001600160041001500410015004100160041001500160015001600150016001600410015001600150016001500160015001600160041001500410015001A060055AA" Continuous="0" Repeats="2" FunctionName="RGBCMY"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC001500410016004100150016001500160015001600160015001600160015004100150041001600150016004100150016001500410016001500160041001500160015004100160016001500160015001600150041001600410015001600150041001600150016004100150041001500410016001600150016001500410015001600160019060055AA" Continuous="0" Repeats="2" FunctionName="RIGTH"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005701AC00150041001500420014001700140017001500160015001700140017001400420015004100150017001400420014001700150042001400170014004200140017001500420014004200140017001500420014004200140042001500160015001700140017001400170014004200150016001500170014001700140042001500420014001B060055AA" Continuous="0" Repeats="2" FunctionName="SHARPNESS"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005601AD00140042001400420015001700140017001400170014001700150016001500420014004200140017001500410015001700140042001400170015004200140017001400170014001700150042001400420014004200150016001500170014004200140042001500420014001700140017001400170014004300140042001400170014001B060055AA" Continuous="0" Repeats="2" FunctionName="S-VIDEO"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005601AD00140042001400420015001700140017001400170014001700150016001500420014004200140017001500420014001700140042001400170015004200140017001400170014001700150016001500160015004200140042001500160015004200140042001400420015004200140042001500160015001600150042001400170014001B060055AA" Continuous="0" Repeats="2" FunctionName="UP"/>\
<SCMDIR DataToggle="" Data="55AA009A0500000004PP01000200006B00000022005801AB00150042001500410015001600150016001500160016001600150016001500410015004100160016001500410015001600150041001600160015004100150016001500160016001600150016001500160015004100160041001500410015001600150042001500410015004100160041001500160015001600150016001500420015001A060055AA" Continuous="0" Repeats="2" FunctionName="VIDEO"/>\
</Functions></SDriverIR>'

device_FunctionName = sys.argv[1]
device_header = '55aa009a050800'
device_port = '0401'
device_base = 72

Device = minidom.parseString(device_config)
for Function in Device.getElementsByTagName('SCMDIR'):
    if Function.getAttribute('FunctionName') == device_FunctionName:
        Comando0 = Function.attributes['Data'].value
        break

while True:

    IFSEI = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

    IFSEI.settimeout ( 3 )

    IFSEI_address = ( '192.168.1.202', 25200 )

    try:

        for k in HandShake.keys():
 
            print(k)

            sent = IFSEI.sendto(k, IFSEI_address)

            data, server = IFSEI.recvfrom(512)

            print(data)

            if data == HandShake[k]:

                break

        break

    except:
            
        IFSEI.close


for i in range(2):
    hi = "{:02x}".format(i)
    hf = "{:02x}".format(i + device_base)

    Comando = Comando0
    Comando = device_header + hi + device_port + Comando[20:len(Comando) - 6] + hf + Comando[-4:]
    Comando = bytes.fromhex(Comando)
    sent = IFSEI.sendto(Comando, IFSEI_address)
    print(Comando)
    data, server = IFSEI.recvfrom(1024)
    print(data)


