import socket
from xml.dom import minidom
import codecs
import sys

decode_hex = codecs.getdecoder("hex_codec")

HandShake = {b'U\xaa\x00\x06\x05\x02\x00\x00\x0c\x19U\xaa': b'U\xaa\x00\x06\x06\x02\x00\x00\x01\x0fU\xaa',
             b'U\xaa\x00\x06\x05\x03\x00\x00\x16$U\xaa': b'U\xaa\x01\x16\x06\x01\x00\x00\x03\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x00@@@@@@@@\x01\x01#U\xaa',
             b'U\xaa\x00\x08\x05\x04\x00\x00\x15\xd3\xb5\xaeU\xaa': b'U\xaa\x00\x1b\x06\x01\x00\x00\x16Ver 04.11.00|DS 05.02/U\xaa',
}

AC_config = '<?xml version="1.0" encoding="UTF-8"?>' + \
'<SDriverIR IRToggle="0" Name="R14"><Functions>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E0014001400140014001400140014001400140014001400140014001400140014001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E001400140014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E0014001400140014001400140014001400140014001400140014001400140014001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E001400140014003E0014003E0014003E001400D3040055AA" Continuous="0" Repeats="2" FunctionName="17"/>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E00140014001400140014001400140014001400140014001400140014001400140014003E0014003E0014001400140014001400140014003E0014003E0014003E00140014001400140014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E00140014001400140014001400140014001400140014001400140014001400140014003E0014003E0014001400140014001400140014003E0014003E0014003E00140014001400140014003E0014003E0014003E001400D4040055AA" Continuous="0" Repeats="2" FunctionName="18"/>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E001400140014001400140014001400140014001400140014001400140014003E0014003E0014003E0014001400140014001400140014003E0014003E0014001400140014001400140014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E001400140014001400140014001400140014001400140014001400140014003E0014003E0014003E0014001400140014001400140014003E0014003E0014001400140014001400140014003E0014003E0014003E001400D4040055AA" Continuous="0" Repeats="2" FunctionName="19"/>' + \
'<SCMDIR DataToggle="" Data="55AA012A0500000004PP01000200006D00000046005501AA0019003E00190015001900140019003F0019001400190015001900150019001400190015001900150018003F001900140019001500190015001900140019001500190015001900140019001500190014001900150019003E0019003F00190014001900150019001400190015001900150019003E001900150019003E00190015001800150019003E00190015001900F3021900150019001500190014001900150019001500190014001900150019001400190015001900150019001400190015001900150018003F00190014001900150019001500190014001900150019001500190014001900150019001400190015001900150019001400190015001900150019003E00190014001900150019003E001900F3020055AA" Continuous="0" Repeats="2" FunctionName="20"/>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E0014001400140014001400140014001400140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E00140014001400140014003E001400140014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E0014001400140014001400140014001400140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E00140014001400140014003E001400140014003E0014003E0014003E001400D4040055AA" Continuous="0" Repeats="2" FunctionName="21"/>' + \
'<SCMDIR DataToggle="" Data="55AA012A0500000004PP01000200006D00000046005601A90019003E00190015001900150019003E00190015001900140019001500190015001800150019003E0019003F001900140019001500190014001900150019001500190014001900150019001500180015001900150019003E0019003E00190015001900150019001400190015001900140019003F001900140019004000190014001900150019003E00190015001900F2021A001500190015001900140019001500190014001A0014001900150019001400190015001900150019001400190015001900150018003F001900140019001500190014001A0014001900150019001400190015001900150019001400190015001900150019001400190015001900140019003F0019003E001900150019003E001900F2020055AA" Continuous="0" Repeats="2" FunctionName="22"/>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E0014001400140014001400140014001400140014001400140014003E001400140014003E0014003E0014001400140014001400140014003E001400140014003E00140014001400140014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E0014001400140014001400140014001400140014001400140014003E001400140014003E0014003E0014001400140014001400140014003E001400140014003E00140014001400140014003E0014003E0014003E001400D4040055AA" Continuous="0" Repeats="2" FunctionName="23"/>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E00140014001400140014001400140014001400140014003E0014003E00140014001400140014003E00140014001400140014001400140014001400140014003E0014003E001400140014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E0014001400140014001400140014003E0014003E0014003E0014003E0014003E0014003E0014003E0014003E00140014001400140014001400140014001400140014003E0014003E00140014001400140014003E00140014001400140014001400140014001400140014003E0014003E001400140014003E0014003E0014003E001400D4040055AA" Continuous="0" Repeats="2" FunctionName="24"/>' + \
'<SCMDIR DataToggle="" Data="55AA01A20500000004PP01000200006D0000006400AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E001400140014003E0014003E0014003E0014003E001400140014003E0014003E0014003E001400140014001400140014001400140014003E00140014001400140014003E0014003E0014003E00140014001400140014001400140014001400140014001400140014001400140014003E0014003E0014003E0014003E0014003E001400CB00AB00AB0014003E001400140014003E0014003E00140014001400140014003E00140014001400140014003E00140014001400140014003E0014003E001400140014003E001400140014003E0014003E0014003E0014003E001400140014003E0014003E0014003E001400140014001400140014001400140014003E00140014001400140014003E0014003E0014003E00140014001400140014001400140014001400140014001400140014001400140014003E0014003E0014003E0014003E0014003E001400D4040055AA" Continuous="0" Repeats="2" FunctionName="OFF"/>' + \
'</Functions></SDriverIR>'

device_FunctionName = sys.argv[1]
device_header = "55aa01a2050700"
device_port = "0400"
device_base = 222


Device = minidom.parseString(AC_config)
for Function in Device.getElementsByTagName('SCMDIR'):
    if Function.getAttribute('FunctionName') == device_FunctionName:
        Comando0 = Function.attributes['Data'].value
        break

while True:

    IFSEI = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

    IFSEI.settimeout ( 3 )

    IFSEI_address = ( '192.168.1.202', 25200 )

    try:

        for k in HandShake.keys():
 
            print(k)

            sent = IFSEI.sendto(k, IFSEI_address)

            data, server = IFSEI.recvfrom(512)

            print(data)

            #if data == HandShake[k]:

            break

        break

    except:
            
        IFSEI.close


for i in range(5):
    hi = "{:02x}".format(i)
    hf = "{:02x}".format(i + device_base)

    Comando = Comando0
    Comando = device_header + hi + device_port + Comando[20:len(Comando) - 6] + hf + Comando[-4:]
    Comando = bytes.fromhex(Comando)
    sent = IFSEI.sendto(Comando, IFSEI_address)
    print(Comando)
    data, server = IFSEI.recvfrom(1024)
    print(data)

print("Comando Completo")

